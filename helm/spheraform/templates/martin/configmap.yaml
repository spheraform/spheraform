{{- if .Values.martin.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "spheraform.fullname" . }}-martin-config
  labels:
    {{- include "spheraform.labels" . | nindent 4 }}
    app.kubernetes.io/component: martin
data:
  martin-config.yaml: |
    # Connection pool settings
    pool_size: {{ .Values.martin.config.poolSize }}

    # Auto-discovery settings
    auto_bounds: {{ .Values.martin.config.autoBounds }}
    {{- if .Values.martin.config.autoPublish.enabled }}
    auto_publish:
      tables:
        from_schemas: {{ .Values.martin.config.autoPublish.tables.fromSchemas }}
        id_columns:
        {{- range .Values.martin.config.autoPublish.tables.idColumns }}
          - {{ . }}
        {{- end }}
        source_id_format: {{ .Values.martin.config.autoPublish.tables.sourceIdFormat | quote }}
        tables: {{ .Values.martin.config.autoPublish.tables.tables | quote }}
        buffer: {{ .Values.martin.config.autoPublish.tables.buffer }}
        extent: {{ .Values.martin.config.autoPublish.tables.extent }}
        clip_geom: {{ .Values.martin.config.autoPublish.tables.clipGeom }}
        geometry_column: {{ .Values.martin.config.autoPublish.tables.geometryColumn }}
        srid: {{ .Values.martin.config.autoPublish.tables.srid }}
    {{- end }}

    # Default tile generation settings
    default_srid: {{ .Values.martin.config.defaultSrid }}
{{- end }}
